<img id="img" src="./testimg.jpg" style="image-rendering: pixelated;" width="512" height="512" onload="onImgLoad()" />
<canvas id="canvas" width="64" height="64" style="height: 512px; width: 512px; image-rendering: pixelated;"></canvas>

<script>

	var ctx;

	function onImgLoad() {
		var canvas = document.getElementById("canvas");

		var img = document.getElementById("img");

		ctx = canvas.getContext("2d");
		ctx.webkitImageSmoothingEnabled = false;
		ctx.mozImageSmoothingEnabled = false;
		ctx.msImageSmoothingEnabled = false;
		ctx.imageSmoothingEnabled = false;

		ctx.drawImage(img, 0, 0, 64, 64);

		console.log(JSON.stringify({
			type: "static image",
			rows: 64,
			cols: 64,
			data: getPixelArray()
		}));
	}

	function getPixelArray() {

		var pixels = [];

		for(var y = 0; y < 64; y++) {
			pixels[y] = [];
			for(var x = 0; x < 64; x++) {
				var pixel = ctx.getImageData(x, y, 1, 1);
				pixels[y][x] = rgb565(pixel.data[0], pixel.data[1], pixel.data[2])
			}
		}

		return pixels;
	}

	function setConvertedPixels() {
		var pixels = getPixelArray();
		
		var id = ctx.createImageData(1,1);

		for(var y = 0; y < 64; y++) {
			for(var x = 0; x < 64; x++) {
				var pixel = rgb888(pixels[y][x]);
				id.data[0]   = pixel.r;
				id.data[1]   = pixel.g;
				id.data[2]   = pixel.b;
				id.data[3]   = 255;
				ctx.putImageData(id, x, y);
			}
		}

	}

	function rgb565(red, green, blue) {
		return (((red & 0b11111000)<<8) + ((green & 0b11111100)<<3) + (blue>>3));
	}

	function rgb888(rgb565) {
		r = ((((rgb565 >> 11) & 0x1F) * 527) + 23) >> 6;
		g = ((((rgb565 >> 5) & 0x3F) * 259) + 33) >> 6;
		b = (((rgb565 & 0x1F) * 527) + 23) >> 6;

		return {
			r: r,
			g: g,
			b: b
		};
	}

</script>